  const planningDto = {
  "poste": { "id": 2, "nom": "GTI" },
  "startDate": "2026-01-01",
  "endDate": "2026-01-14",
  "days": [
    {
      "day_date": "2026-01-01",
      "day_type": "working",
      "description": null,
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [{ "id": 101, "nom": "ALENGRIN", "prenom": "Julien", "code_personnel": "CP0101", "actif": true }] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [{ "id": 102, "nom": "MARTIN", "prenom": "Sarah", "code_personnel": "CP0102", "actif": true }] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [{ "id": 103, "nom": "DUPONT", "prenom": "Nicolas", "code_personnel": "CP0103", "actif": true }] }
      ]
    },
    {
      "day_date": "2026-01-02",
      "day_type": "working",
      "description": null,
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [{ "id": 104, "nom": "BENALI", "prenom": "Leïla", "code_personnel": "CP0104", "actif": true }] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [{ "id": 105, "nom": "ROUSSEAU", "prenom": "Thomas", "code_personnel": "CP0105", "actif": true }] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [{ "id": 101, "nom": "ALENGRIN", "prenom": "Julien", "code_personnel": "CP0101", "actif": true }] }
      ]
    },
    {
      "day_date": "2026-01-03",
      "day_type": "working",
      "description": null,
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [{ "id": 102, "nom": "MARTIN", "prenom": "Sarah", "code_personnel": "CP0102", "actif": true }] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [{ "id": 103, "nom": "DUPONT", "prenom": "Nicolas", "code_personnel": "CP0103", "actif": true }] }
      ]
    },
    {
      "day_date": "2026-01-04",
      "day_type": "working",
      "description": "Dimanche : effectif réduit",
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [{ "id": 104, "nom": "BENALI", "prenom": "Leïla", "code_personnel": "CP0104", "actif": true }] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [] }
      ]
    },
    {
      "day_date": "2026-01-05",
      "day_type": "working",
      "description": null,
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [{ "id": 101, "nom": "ALENGRIN", "prenom": "Julien", "code_personnel": "CP0101", "actif": true }, { "id": 104, "nom": "BENALI", "prenom": "Leïla", "code_personnel": "CP0104", "actif": true }] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [{ "id": 102, "nom": "MARTIN", "prenom": "Sarah", "code_personnel": "CP0102", "actif": true }] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [{ "id": 103, "nom": "DUPONT", "prenom": "Nicolas", "code_personnel": "CP0103", "actif": true }] }
      ]
    },
    {
      "day_date": "2026-01-06",
      "day_type": "working",
      "description": null,
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [{ "id": 105, "nom": "ROUSSEAU", "prenom": "Thomas", "code_personnel": "CP0105", "actif": true }] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [{ "id": 102, "nom": "MARTIN", "prenom": "Sarah", "code_personnel": "CP0102", "actif": true }] }
      ]
    },
    {
      "day_date": "2026-01-07",
      "day_type": "working",
      "description": null,
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [{ "id": 104, "nom": "BENALI", "prenom": "Leïla", "code_personnel": "CP0104", "actif": true }] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [{ "id": 101, "nom": "ALENGRIN", "prenom": "Julien", "code_personnel": "CP0101", "actif": true }] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [] }
      ]
    },
    {
      "day_date": "2026-01-08",
      "day_type": "working",
      "description": null,
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [{ "id": 103, "nom": "DUPONT", "prenom": "Nicolas", "code_personnel": "CP0103", "actif": true }] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [{ "id": 105, "nom": "ROUSSEAU", "prenom": "Thomas", "code_personnel": "CP0105", "actif": true }] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [{ "id": 104, "nom": "BENALI", "prenom": "Leïla", "code_personnel": "CP0104", "actif": true }] }
      ]
    },
    {
      "day_date": "2026-01-09",
      "day_type": "working",
      "description": null,
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [{ "id": 102, "nom": "MARTIN", "prenom": "Sarah", "code_personnel": "CP0102", "actif": true }, { "id": 105, "nom": "ROUSSEAU", "prenom": "Thomas", "code_personnel": "CP0105", "actif": true }] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [{ "id": 101, "nom": "ALENGRIN", "prenom": "Julien", "code_personnel": "CP0101", "actif": true }] }
      ]
    },
    {
      "day_date": "2026-01-10",
      "day_type": "working",
      "description": "Samedi : uniquement matin + soir",
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [{ "id": 104, "nom": "BENALI", "prenom": "Leïla", "code_personnel": "CP0104", "actif": true }] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [{ "id": 103, "nom": "DUPONT", "prenom": "Nicolas", "code_personnel": "CP0103", "actif": true }] }
      ]
    },
    {
      "day_date": "2026-01-11",
      "day_type": "working",
      "description": "Dimanche : poste OFF",
      "is_off_shift": true,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [] }
      ]
    },
    {
      "day_date": "2026-01-12",
      "day_type": "working",
      "description": null,
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [{ "id": 101, "nom": "ALENGRIN", "prenom": "Julien", "code_personnel": "CP0101", "actif": true }] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [{ "id": 104, "nom": "BENALI", "prenom": "Leïla", "code_personnel": "CP0104", "actif": true }] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [{ "id": 105, "nom": "ROUSSEAU", "prenom": "Thomas", "code_personnel": "CP0105", "actif": true }] }
      ]
    },
    {
      "day_date": "2026-01-13",
      "day_type": "working",
      "description": "Absence non remplacée sur S",
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [{ "id": 103, "nom": "DUPONT", "prenom": "Nicolas", "code_personnel": "CP0103", "actif": true }] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [{ "id": 102, "nom": "MARTIN", "prenom": "Sarah", "code_personnel": "CP0102", "actif": true }] }
      ]
    },
    {
      "day_date": "2026-01-14",
      "day_type": "working",
      "description": null,
      "is_off_shift": false,
      "tranches": [
        { "tranche": { "id": 3, "nom": "GTI M", "heure_debut": "06:15:00", "heure_fin": "14:00:00", "poste_id": 2 }, "agents": [{ "id": 105, "nom": "ROUSSEAU", "prenom": "Thomas", "code_personnel": "CP0105", "actif": true }] },
        { "tranche": { "id": 4, "nom": "GTI S", "heure_debut": "13:55:00.133000", "heure_fin": "22:00:00.133000", "poste_id": 2 }, "agents": [{ "id": 104, "nom": "BENALI", "prenom": "Leïla", "code_personnel": "CP0104", "actif": true }] },
        { "tranche": { "id": 5, "nom": "GTI N", "heure_debut": "22:00:00.133000", "heure_fin": "06:15:00.133000", "poste_id": 2 }, "agents": [{ "id": 101, "nom": "ALENGRIN", "prenom": "Julien", "code_personnel": "CP0101", "actif": true }] }
      ]
    }
  ]
}

import { notFound } from "next/navigation";

import { getPostePlanning } from "@/services/planning.service";
import type { PostePlanning } from "@/types/postePlanning";

import { buildPostePlanningVm } from "@/features/planning-poste/vm/postePlanning.vm.builder";

import {
  monthAnchorISO,
  monthGridRangeFrom,
} from "@/features/planning/utils/month.utils";

import { PostePlanningHeader } from "@/features/planning-poste/components/PostePlanningHeader";
import { MonthlyPlanningGrid } from "@/features/planning-poste/components/MonthlyPlanningGrid";

type PageProps = {
  params: Promise<{ posteId: string }>;
  searchParams: Promise<{ date?: string }>;
};

export default async function PostePlanningPage({ params, searchParams }: PageProps) {
  const [{ posteId: rawId }, { date }] = await Promise.all([params, searchParams]);

  const posteId = Number(rawId);
  if (!Number.isFinite(posteId)) notFound();

  const anchor = monthAnchorISO(date ?? new Date().toISOString().slice(0, 10));
  const range = monthGridRangeFrom(anchor);

  const dto: PostePlanning = await getPostePlanning(posteId, {
    startDate: range.start,
    endDate: range.end,
  });

  const planning = buildPostePlanningVm(dto);

  return (
    <div className="space-y-4">
      <PostePlanningHeader poste={planning.poste} anchorMonth={anchor} />
      <MonthlyPlanningGrid anchorMonth={anchor} planning={planning} />
    </div>
  );
}
